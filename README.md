# Sybil model usage report
by Nikita Kozlov

## Directory structure

The following is the directory structure of the repository necessary to run the notebook:
```
.
├── data                          # Directory with the patient scans in NLST format
│   ├── manifest-1725486726463    # Manifest file
├── results                       # Directory with the attention visualizations for each patient scan (generated by the notebook)
├── sybil_model_report.ipynb      # Jupyter notebook with the Sybil model usage report
└── README.md                     # README file
```

The following is the notebook artifacts example stores in the repository for easier access:
```.
├── results
│   └──  report.csv               # Report with the predictions scores per patient scan per year
```

## About the notebook

This notebook demonstrates how to use the Sybil model to predict the lung cancer probability for each patient scan and generate a report with the predictions and attention visualizations.

The notebook provides the following functionality:
1. It loads the Sybil model and prepares the data for prediction.
2. It predicts the lung cancer probability for each patient scan.
3. It generates attention visualizations for each patient scan.
4. It generates a report with the predictions scores per patient scan per year.

The notebook requires the following files:
- `data` directory with the patient scans in NLST format. Example of the data directory structure:
    ```
    data
    ├── manifest-1725486726463 (manifest file is provided in the repository)
    │    ├── NLST
    │    │   ├── <Patient ID>
    │    │   │   ├── <Scan ID>
    │    │   │   │   ├── <Series ID>
    │    │   │   │   │   └── <DICOM files> (1-0001.dcm, 1-0002.dcm, ...)
    │    │   └── ...
    ```

The notebook generates the following files:
- `results` directory with the attention visualizations for each patient scan.
- `results/predictions_per_patient.pkl` file with the predictions per patient scan cache.
- `results/report.csv` file with the predictions scores per patient scan per year.

## Reproducing the results

### 1. Requirements

- Anaconda with Python 3.10
- Jupyter Notebook

### 2. Installation

- The repository contains a report in the form of a Jupyter Notebook. 
- This notebook contains all necessary code and package installation routines to reproduce the results.

### 3. Data preparation
- [manifest-1725486726463.tcia](manifest-1725486726463.tcia) - the following file is the manifest file for the dataset used in the analysis.
  One should use NBIA Data Retriever to download the dataset into the `data` folder.

### 4. Running the notebook
- To run the notebook, one should open the notebook in Jupyter Notebook and run all cells.

### 5. Results
- The notebook will produce the following artifacts:
  - `results` folder containing the attention visualization images for each loaded patient scan.
  - `results/report.csv' file containing the results of the model evaluation on patient scans.

## References

- [Sybil model](https://pubmed.ncbi.nlm.nih.gov/36634294/)
- [Sybil model repository](https://github.com/reginabarzilaygroup/Sybil)
- [NLST dataset](https://www.cancerimagingarchive.net/collection/nlst/)
- [NBIA Data Retriever](https://wiki.cancerimagingarchive.net/display/NBIA/Downloading+TCIA+Images)
